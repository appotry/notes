å¿«é€Ÿå¼€å§‹
========

æœ€å°Flaskåº”ç”¨
-------------

``hello.py``,ä¸èƒ½ä½¿ç”¨\ ``flask.py``\ åšæ–‡ä»¶å,ä¼šä¸æ¨¡å—å†²çª

.. code:: python

    # å¯¼å…¥Flask
    from flask import Flask
    # appå®ä¾‹æ˜¯æˆ‘ä»¬çš„WSGIåº”ç”¨
    app = Flask(__name__)

    # ä½¿ç”¨route()è£…é¥°å™¨å‘Šè¯‰Flask,ä»€ä¹ˆurlå°†è§¦å‘å‡½æ•°
    @app.route('/')
    def hello_world():
        return 'hello world'

è¿è¡Œ\ ``hello.py``

ä½¿ç”¨ **flask** å‘½ä»¤æˆ–è€… ``python -m flask run``.

è¿è¡Œä¹‹å‰éœ€è¦å£°æ˜\ ``FLASK_APP``
ç¯å¢ƒå˜é‡,å¦‚æœä½¿ç”¨Windows,åˆ™è¦ä½¿ç”¨\ ``set``\ ä»£æ›¿\ ``export``

å‘½ä»¤è¡Œæ‰§è¡Œ

.. code:: shell

    $ export FLASK_APP=hello.py
    $ flask run
     * Serving Flask app "hello"
     * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)

æˆ–è€… **python -m flask**:

.. code:: shell

    $ export FLASK_APP=hello.py
    $ python -m flask run
     * Serving Flask app "hello"
     * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)

ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ä¼šå¯åŠ¨ä¸€ä¸ªç®€å•çš„å†…ç½®\ ``web server``,è¯¥Serverä»…ç”¨äºæµ‹è¯•.

**ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**\ å¯ä»¥å‚è€ƒ `Deployment
Options <http://flask.pocoo.org/docs/0.12/deploying/#deployment>`__.

è®¿é—® http://127.0.0.1:5000/

é»˜è®¤,flaskå¯åŠ¨åœ¨è°ƒè¯•æ¨¡å¼ä¸‹,å¦‚æœéœ€è¦ç›‘å¬æ‰€æœ‰IP,ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤

.. code:: shell

    flask run --host=0.0.0.0

Have another debugger in mind? See `Working with
Debuggers <http://flask.pocoo.org/docs/0.12/errorhandling/#working-with-debuggers>`__.

è·¯ç”±
----

``route()``\ è£…é¥°å™¨ç”¨äºç»‘å®šå‡½æ•°åˆ°URL

ç¤ºä¾‹

.. code:: python

    @app.route('/')
    def index():
        return 'Index Page'

    @app.route('/hello')
    def hello():
        return 'Hello, World'

åŒæ—¶å¯ä»¥å°†URLçš„ä¸€éƒ¨åˆ†è®¾ç½®æˆåŠ¨æ€ä»¥åŠé™„åŠ å¤šä¸ªè§„åˆ™åœ¨ä¸€ä¸ªå‡½æ•°ä¸Š

å¯å˜è§„åˆ™
~~~~~~~~

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç‰¹æ®Šæ ‡è®°,å°†å˜é‡æ·»åŠ åˆ°URLé‡Œé¢.
æ¯”å¦‚ä½¿ç”¨\ ``<å˜é‡å>``,è¿™ç§æ ¼å¼,å°†ä¼šä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™å‡½æ•°.è¿˜å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè½¬æ¢å™¨\ ``<è½¬æ¢å™¨:å˜é‡å>``

.. code:: python

    @app.route('/user/<username>')
    def show_user_profile(username):
        # show the user profile for that user
        return 'User %s' % username

    @app.route('/post/<int:post_id>')
    def show_post(post_id):
        # show the post with the given id, the id is an integer
        return 'Post %d' % post_id

æ”¯æŒçš„è½¬æ¢å™¨

+--------+------------------------------------------------+
| string | accepts any text without a slash (the default) |
+========+================================================+
| int    | accepts integers                               |
+--------+------------------------------------------------+
| float  | like ``int`` but for floating point values     |
+--------+------------------------------------------------+
| path   | like the default but also accepts slashes      |
+--------+------------------------------------------------+
| any    | matches one of the items provided              |
+--------+------------------------------------------------+
| uuid   | accepts UUID strings                           |
+--------+------------------------------------------------+

å”¯ä¸€URLs/é‡å®šå‘
~~~~~~~~~~~~~~~

Flask
URLè§„åˆ™åŸºäºWerkzeugçš„è·¯ç”±æ¨¡å—.è¿™ä¸ªæ¨¡å—èƒŒåçš„ç†å¿µæ¥è‡ªApacheä»¥åŠæ—©æœŸçš„HTTPæœåŠ¡.

.. code:: python

    @app.route('/projects/')
    def projects():
        return 'The project page'

    @app.route('/about')
    def about():
        return 'The about page'

ä¸Šé¢ä¸¤ä¸ªç¤ºä¾‹çœ‹èµ·æ¥å¾ˆç›¸ä¼¼,åŒºåˆ«åœ¨äºç»“å°¾çš„\ ``/``.ç¬¬ä¸€ç§æƒ…å†µ,æ˜¯æœ«å°¾å¸¦æœ‰æ–œæ çš„è§„èŒƒåŒ–URL.å®ƒç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ–‡ä»¶å¤¹,å¦‚æœä¸å¸¦\ ``/``\ è®¿é—®,Flaskå°†è‡ªåŠ¨è·³è½¬åˆ°å°¾ç«¯å¸¦æ–œçº¿çš„è§„èŒƒåŒ–çš„URL.

ç¬¬äºŒç§æƒ…å†µ,urlå®šä¹‰å°¾ç«¯ä¸å¸¦\ ``/``,åƒç±»Unixç³»ç»Ÿä¸Šçš„æ–‡ä»¶çš„è·¯å¾„å,å¦‚æœå¸¦\ ``/``\ è®¿é—®,å°†ä¼šè¿”å›\ ``404``\ é”™è¯¯

è¿™ç§è¡Œä¸º,æ˜¯ç›¸å¯¹urlä¹Ÿèƒ½ç»§ç»­å·¥ä½œ,ç¬¦åˆApacheå’Œå…¶ä»–æœåŠ¡å™¨çš„å·¥ä½œæ¨¡å¼ã€‚åŒæ—¶,urlå°†ä¿æŒç‹¬ç‰¹,è¿™æœ‰åŠ©äºæœç´¢å¼•æ“é¿å…ä¸¤æ¬¡ç´¢å¼•ç›¸åŒçš„é¡µé¢ã€‚

URLæ„å»º
~~~~~~~

``url_for()``

æ¥å—ä¸€ä¸ªå‡½æ•°åä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°

.. code:: python

    >>> from flask import Flask, url_for
    >>> app = Flask(__name__)
    >>> @app.route('/')
    ... def index(): pass
    ...
    >>> @app.route('/login')
    ... def login(): pass
    ...
    >>> @app.route('/user/<username>')
    ... def profile(username): pass
    ...
    >>> with app.test_request_context():
    ...  print url_for('index')
    ...  print url_for('login')
    ...  print url_for('login', next='/')
    ...  print url_for('profile', username='John Doe')
    ...
    /
    /login
    /login?next=/
    /user/John%20Doe

HTTPæ–¹æ³•
~~~~~~~~

é»˜è®¤æƒ…å†µä¸‹,è·¯ç”±ä»…åº”ç­”\ ``GET``\ è¯·æ±‚,å¯ä»¥é€šè¿‡è£…é¥°å™¨\ ``route() ä¸­çš„methods``\ å‚æ•°æ¥æ”¹å˜.

.. code:: python

    from flask import request

    @app.route('/login', methods=['GET', 'POST'])
    def login():
        if request.method == 'POST':
            do_the_login()
        else:
            show_the_login_form()

å½“\ ``GET``\ è¯·æ±‚å­˜åœ¨çš„æ—¶å€™,\ ``HEAD``\ ä¼šè¢«è‡ªåŠ¨æ·»åŠ ,å¹¶æŒ‰ç…§ `HTTP
RFC <http://www.ietf.org/rfc/rfc2068.txt>`__
çš„è¦æ±‚æ¥å¤„ç†,æˆ‘ä»¬å¹¶ä¸éœ€è¦è‡ªå·±å¤„ç†.

HTTPæ–¹æ³•ç®€å•ä»‹ç»

``GET``

::

    è¯·æ±‚æŒ‡å®šé¡µé¢ä¿¡æ¯,å¹¶è¿”å›å®ä½“ä¸»ä½“

``HEAD``

â€‹ ä»…è·å–æŠ¥å¤´,è€Œä¸å…³æ³¨é¡µé¢å†…å®¹

``POST``

â€‹
æƒ³æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚(æ¯”å¦‚æäº¤è¡¨å•æˆ–ä¸Šä¼ æ–‡ä»¶).æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚ä½“ä¸­,POSTè¯·æ±‚å¯èƒ½ä¼šå¯¼è‡´æ–°çš„èµ„æºçš„å»ºç«‹,æˆ–å·²æœ‰èµ„æºçš„ä¿®æ”¹

``PUT``

::

    ä»å®¢æœç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®å–ä»£æŒ‡å®šçš„æ–‡æ¡£çš„å†…å®¹

``DELETE``

::

    è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šçš„é¡µé¢

``CONNECT``

::

    HTTP/1.1åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚

``OPTIONS``

::

    å…è®¸å®¢æˆ·ç«¯æŸ¥çœ‹æœåŠ¡å™¨çš„æ€§èƒ½ã€‚

``TRACE``

::

    å›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ã€‚

é™æ€æ–‡ä»¶
--------

åŠ¨æ€webåº”ç”¨åŒæ—¶ä¹Ÿéœ€è¦é™æ€æ–‡ä»¶.

ç”Ÿæˆé™æ€æ–‡ä»¶çš„URLs,ä½¿ç”¨

.. code:: python

    url_for('static', filename='style.css')

æ–‡ä»¶è¢«å­˜æ”¾åœ¨ç£ç›˜ä¸Š ``static/style.css``.

æ¨¡æ¿
----

Flask ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é…ç½® `Jinja2 <http://jinja.pocoo.org/>`__ template
å¼•æ“.

ä½¿ç”¨\ ``render_template()``\ æ–¹æ³•å‘ˆç°ä¸€ä¸ªæ¨¡æ¿,æˆ‘ä»¬åªéœ€è¦æä¾›æ¨¡æ¿åå­—,ä»¥åŠæˆ‘ä»¬éœ€è¦å‘ˆç°çš„å˜é‡çš„åç§°ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™æ¨¡æ¿å¼•æ“.

.. code:: python

    from flask import render_template

    @app.route('/hello/')
    @app.route('/hello/<name>')
    def hello(name=None):
        return render_template('hello.html', name=name)

Flaskå°†åœ¨æ¨¡æ¿ç›®å½•æŸ¥æ‰¾å¯¹åº”æ¨¡æ¿.

**1**: ä¸€ä¸ª\ ``py``\ æ–‡ä»¶

.. code:: shell

    /application.py
    /templates
        /hello.html

**2**: ä¸€ä¸ªåŒ…

.. code:: shell

    /application
        /__init__.py
        /templates
            /hello.html

Jinja2æ¨¡æ¿æ–‡æ¡£ `Jinja2 Template
Documentation <http://jinja.pocoo.org/docs/templates>`__

æ¨¡æ¿ç¤ºä¾‹

.. code:: html

    <!doctype html>
    <title>Hello from Flask</title>
    {% if name %}
      <h1>Hello {{ name }}!</h1>
    {% else %}
      <h1>Hello, World!</h1>
    {% endif %}

åœ¨æ¨¡æ¿å†…è¿˜å¯ä»¥è®¿é—®
```request`` <http://flask.pocoo.org/docs/0.12/api/#flask.request>`__,
```session`` <http://flask.pocoo.org/docs/0.12/api/#flask.session>`__ ,
```g`` <http://flask.pocoo.org/docs/0.12/api/#flask.g>`__
[`1] <http://flask.pocoo.org/docs/0.12/quickstart/#id5>`__ å¯¹è±¡ä»¥åŠ
```get_flashed_messages()`` <http://flask.pocoo.org/docs/0.12/api/#flask.get_flashed_messages>`__
æ–¹æ³•.

è®¿é—®è¯·æ±‚æ•°æ®
------------

webåº”ç”¨ä¸å®¢æˆ·ç«¯å‘é€çš„æ•°æ®è¿›è¡Œäº¤äº’æ˜¯è‡³å…³é‡è¦çš„.åœ¨\ ``Flask``\ ä¸­,è¿™äº›ä¿¡æ¯ç”±å…¨å±€å¯¹è±¡\ ``request``\ æä¾›.å¦‚æœä½ æœ‰ä¸€äº›ä½¿ç”¨pythonçš„ç»éªŒ,ä½ ä¼šå¥½å¥‡,ä¸ºä»€ä¹ˆè¿™ä¸ªå¯¹è±¡æ˜¯å…¨å±€çš„,
ä¸ºä»€ä¹ˆ\ ``Flask``\ è¿˜èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨, ç­”æ¡ˆæ˜¯\ ``ç¯å¢ƒä½œç”¨åŸŸ``

å±€éƒ¨ç¯å¢ƒ
~~~~~~~~

å¦‚æœä½ æƒ³ç†è§£å…¶å·¥ä½œæœºåˆ¶,ä»¥åŠå¦‚ä½•åˆ©ç”¨ç¯å¢ƒå˜é‡å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•,é˜…è¯»è¿™èŠ‚,å¦åˆ™è·³è¿‡å®ƒ.

``Flask``\ ä¸­æŸäº›å¯¹è±¡æ˜¯å…¨å±€çš„, ä½†ä¸æ˜¯é€šå¸¸çš„é‚£ç§.
è¿™äº›å¯¹è±¡å®é™…ä¸Šæ˜¯ç‰¹å®šç¯å¢ƒçš„å±€éƒ¨å¯¹è±¡çš„ä»£ç†. è™½ç„¶å¾ˆæ‹—å£,ä½†æ˜¯å…¶å®å¾ˆå¥½ç†è§£.

æƒ³è±¡ä¸€ä¸‹å¤„ç†çº¿ç¨‹çš„ä¸Šä¸‹æ–‡. ä¸€ä¸ªè¯·æ±‚åˆ°æ¥,
webæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªæ–°çº¿ç¨‹(æˆ–è€…å…¶ä»–ä¸œè¥¿, åªè¦è¿™ä¸ªåº•å±‚å¯¹è±¡å¯ä»¥èƒœä»»å¹¶å‘ç³»ç»Ÿ,
è€Œä¸ä»…ä»…æ˜¯çº¿ç¨‹). å½“\ ``Flask``\ å¼€å§‹å†…éƒ¨è¯·æ±‚å¤„ç†æ—¶, å®ƒè®¤å®šå½“å‰çº¿ç¨‹æ´»åŠ¨,
å¹¶ç»‘å®šå½“å‰åº”ç”¨å’ŒWSGIç¯å¢ƒåˆ°æ­¤çº¿ç¨‹. å®ƒçš„å®ç°æ–¹æ³•å¾ˆå·§å¦™,
èƒ½ä¿è¯ä¸€ä¸ªåº”ç”¨ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ä¸ä¼šå‡ºç°é—®é¢˜.

è¿™å¯¹ä½ æ„å‘³ç€ä»€ä¹ˆ?
åŸºæœ¬ä¸Šä½ å¯ä»¥å®Œå…¨å¿½ç•¥è¿™ç§æƒ…å†µ,é™¤éä½ è¦åšç±»ä¼¼å•å…ƒæµ‹è¯•çš„äº‹æƒ….ä½ ä¼šå‘ç°ä¸€æ®µä¾èµ–è¯·æ±‚å¯¹è±¡çš„ä»£ç ä¼šå› ä¸ºæ²¡æœ‰è¯·æ±‚å¯¹è±¡è€Œæ— æ³•æ­£å¸¸è¿è¡Œ.
è§£å†³æ–¹æ¡ˆæ˜¯, è‡ªè¡Œåˆ›å»ºä¸€ä¸ªè¯·æ±‚å¯¹è±¡, å¹¶ä¸”æŠŠå®ƒç»‘å®šåˆ°ç¯å¢ƒä¸­.
å•å…ƒæµ‹è¯•çš„æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨
```test_request_context()`` <http://flask.pocoo.org/docs/0.12/api/#flask.Flask.test_request_context>`__
è¿›è¡Œç¯å¢ƒç®¡ç†. ç»“åˆ\ ``with``\ å£°æ˜,ç»‘å®šä¸€ä¸ªæµ‹è¯•è¯·æ±‚, è¿™æ ·æ‰å¯ä»¥ä¸ä¹‹äº¤äº’.
ä¾‹å¦‚:

.. code:: python

    from flask import request

    with app.test_request_context('/hello', method='POST'):
        # now you can do something with the request until the
        # end of the with block, such as basic assertions:
        assert request.path == '/hello'
        assert request.method == 'POST'

å¦ä¸€ç§å¯èƒ½æ˜¯, ä¼ é€’æ•´ä¸ªWSGIç¯å¢ƒç»™
```request_context()`` <http://flask.pocoo.org/docs/0.12/api/#flask.Flask.request_context>`__\ æ–¹æ³•:

.. code:: python

    from flask import request

    with app.request_context(environ):
        assert request.method == 'POST'

è¯·æ±‚å¯¹è±¡
~~~~~~~~

å®½æ³›ä»‹ç»ä¸€äº›å¸¸ç”¨æ“ä½œ,
è¯¦æƒ…å‚è§\ ``API``,\ ```request`` <http://flask.pocoo.org/docs/0.12/api/#flask.request>`__

å…ˆå¯¼å…¥æ¨¡å—

.. code:: python

    from flask import request

å½“å‰è¯·æ±‚æ–¹æ³•å¯ä»¥é€šè¿‡\ ``method``\ å±æ€§æ¥è·å–.
è®¿é—®è¡¨å•æ•°æ®(\ **PUT**\ æˆ–\ **POST**\ è¯·æ±‚æäº¤çš„æ•°æ®)å¯ä»¥ä½¿ç”¨\ **``form``**\ å±æ€§.
ä¸‹é¢æ˜¯ä½¿ç”¨å‰é¢ä¸¤ä¸ªå±æ€§çš„å®Œæ•´å®ä¾‹:

.. code:: python

    @app.route('/login', methods=['POST', 'GET'])
    def login():
        error = None
        if request.method == 'POST':
            if valid_login(request.form['username'],
                           request.form['password']):
                return log_the_user_in(request.form['username'])
            else:
                error = 'Invalid username/password'
        # the code below is executed if the request method
        # was GET or the credentials were invalid
        return render_template('login.html', error=error)

å½“è®¿é—®çš„\ ``form``\ å±æ€§\ ``key``\ ä¸å­˜åœ¨çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆ?
è¿™ç§æƒ…å†µä¼šæŠ›å‡º\ ``KeyError``\ å¼‚å¸¸.
ä½ å¯ä»¥åƒæ•æ‰æ ‡å‡†\ ``KeyError``\ ä¸€æ ·æ•æ‰å®ƒ. å¦‚æœä½ ä¸è¿™ä¹ˆåš,
ä¼šæ˜¾ç¤ºä¸€ä¸ªHTTP 400é”™è¯¯é¡µé¢. æ‰€ä»¥, å¤§å¤šæƒ…å†µä¸‹ä¸éœ€è¦å¤„ç†è¿™ä¸ªé—®é¢˜.

è®¿é—®URLä¸­æäº¤çš„å‚æ•°(\ ``?key=value``)å¯ä»¥ä½¿ç”¨\ ``args``\ å±æ€§.

.. code:: python

    searchword = request.args.get('key', '')

æˆ‘ä»¬å»ºè®®ä½¿ç”¨\ ``get``\ æ¥è®¿é—®\ ``URL``\ å‚æ•°æˆ–æ•æ‰\ ``KeyError``,
å› ä¸ºç”¨æˆ·å¯èƒ½ä¼šä¿®æ”¹URL, åŒæ—¶å‘ä»–ä»¬å‘ˆç°ä¸€ä¸ª400é”™è¯¯æ˜¯ä¸å‹å¥½çš„.

è·å–è¯·æ±‚å¯¹è±¡å®Œæ•´çš„æ–¹æ³•å’Œå±æ€§å¯ä»¥æŸ¥é˜…
```request`` <http://flask.pocoo.org/docs/0.12/api/#flask.request>`__\ æ–‡æ¡£.

æ–‡ä»¶ä¸Šä¼ 
~~~~~~~~

ç”¨\ ``Flask``\ ä¸Šä¼ æ–‡ä»¶å¾ˆç®€å•,
åªéœ€è¦åœ¨\ ``form``\ è¡¨å•ä¸­è®¾ç½®\ ``enctype="multipart/form-data"`` å±æ€§,
æ²¡æœ‰è¯¥å±æ€§,æµè§ˆå™¨ä¸ä¼šä¼ è¾“æ–‡ä»¶.

ä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨åœ¨å†…å­˜æˆ–è€…æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªä¸´æ—¶ä½ç½®.
ä½ å¯ä»¥ä½¿ç”¨è¯·æ±‚å¯¹è±¡ä¸­çš„\ ``files``\ å±æ€§è®¿é—®å®ƒä»¬.
æ¯ä¸ªä¸Šä¼ çš„æ–‡ä»¶éƒ½ä¼šå­˜å‚¨åœ¨è¿™ä¸ªå­—å…¸é‡Œé¢,
å®ƒè¡¨ç°ä¸ºä¸€ä¸ªæ ‡å‡†çš„Python\ ``file``\ å¯¹è±¡,
ä½†å®ƒè¿˜æœ‰ä¸€ä¸ª\ ``save()``\ æ–¹æ³•,
è¿™ä¸ªæ–¹æ³•å…è®¸ä½ å°†æ–‡ä»¶å­˜å‚¨åœ¨æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿä¸Š. ä¸‹é¢æ˜¯ä¸€ä¸ªğŸŒ°:

.. code:: python

    from flask import request

    @app.route('/upload', methods=['GET', 'POST'])
    def upload_file():
        if request.method == 'POST':
            f = request.files['the_file']
            f.save('/var/www/uploads/uploaded_file.txt')
        ...

å¦‚æœä½ æƒ³çŸ¥é“ä¸Šä¼ çš„æ–‡ä»¶,åœ¨å®¢æˆ·ç«¯ä¸Šçš„åå­—, å¯ä»¥ä½¿ç”¨\ ``filename``\ å±æ€§,
ä½†æ˜¯è¿™ä¸ªå€¼å¯ä»¥ä¼ªé€ , æ‰€ä»¥ä¸è¦å®Œå…¨ä¿¡ä»»è¿™ä¸ªå€¼.
å¦‚æœä½ è¦ä»¥å®¢æˆ·ç«¯æä¾›çš„æ–‡ä»¶åå°†æ–‡ä»¶å­˜æ”¾åœ¨æœåŠ¡å™¨ä¸Š,
é‚£ä¹ˆè¯·æŠŠå®ƒä¼ é€’ç»™Werkzeugæä¾›çš„\ ```secure_filename()`` <http://werkzeug.pocoo.org/docs/utils/#werkzeug.utils.secure_filename>`__\ æ–¹æ³•

.. code:: python

    from flask import request
    from werkzeug.utils import secure_filename

    @app.route('/upload', methods=['GET', 'POST'])
    def upload_file():
        if request.method == 'POST':
            f = request.files['the_file']
            f.save('/var/www/uploads/' + secure_filename(f.filename))
        ...

å…¶ä»–ä¸€äº›æ¯”è¾ƒå¥½çš„ğŸŒ°, `Uploading
Files <http://flask.pocoo.org/docs/0.12/patterns/fileuploads/#uploading-files>`__\ æ¨¡å¼

Cookies
~~~~~~~

ä½ å¯ä»¥ä½¿ç”¨\ `**``cookies``** <http://flask.pocoo.org/docs/0.12/api/#flask.Request.cookies>`__\ å±æ€§è®¿é—®Cookies,
ä½¿ç”¨å“åº”å¯¹è±¡çš„\ `**``set_cookie``** <http://flask.pocoo.org/docs/0.12/api/#flask.Response.set_cookie>`__\ æ–¹æ³•è®¾ç½®Cookies.
è¯·æ±‚å¯¹è±¡çš„
```cookies`` <http://flask.pocoo.org/docs/0.12/api/#flask.Request.cookies>`__
å±æ€§æ˜¯ä¸€ä¸ªå†…å®¹ç”±å®¢æˆ·ç«¯æä¾›çš„åŒ…å«æ•´ä¸ªCookiesçš„å­—å…¸,
å¦‚æœä½ æƒ³è¦ä½¿ç”¨\ ``sessions``,
ä¸è¦ç›´æ¥ä½¿ç”¨Cookies,ä½¿ç”¨\ `Sessions <http://flask.pocoo.org/docs/0.12/quickstart/#sessions>`__,
åœ¨Flaskä¸­å·²ç»å¤„ç†äº†ä¸€äº›Cookieså®‰å…¨ç»†èŠ‚.

è¯»å–Cookies

.. code:: python

    from flask import request

    @app.route('/')
    def index():
        username = request.cookies.get('username')
        # use cookies.get(key) instead of cookies[key] to not get a
        # KeyError if the cookie is missing.

å­˜å‚¨cookies

.. code:: python

    from flask import make_response

    @app.route('/')
    def index():
        resp = make_response(render_template(...))
        resp.set_cookie('username', 'the username')
        return resp

æ³¨æ„, Cookiesæ˜¯è®¾ç½®åœ¨å“åº”å¯¹è±¡ä¸Šçš„, ç”±äºè§†å›¾å‡½æ•°é€šå¸¸åªè¿”å›å­—ç¬¦ä¸²,
ä¹‹åç”±\ ``Flask``\ è½¬æ¢ä¸ºç›¸åº”å¯¹è±¡.
å¦‚æœä½ è¦æ˜¾ç¤ºåœ°è½¬æ¢,å¯ä»¥ä½¿ç”¨\ ```make_response()`` <http://flask.pocoo.org/docs/0.12/api/#flask.make_response>`__\ å‡½æ•°,
ç„¶åå†è¿›è¡Œä¿®æ”¹.

æœ‰æ—¶å€™ä½ æƒ³åœ¨å“åº”å¯¹è±¡ä¸å­˜åœ¨çš„æ—¶å€™è®¾ç½®cookie, å¯ä»¥ä½¿ç”¨ `Deferred Request
Callbacks <http://flask.pocoo.org/docs/0.12/patterns/deferredcallbacks/#deferred-callbacks>`__
æ¨¡å¼.

ä¹Ÿå¯ä»¥é˜…è¯»æ–‡æ¡£ `About
Responses <http://flask.pocoo.org/docs/0.12/quickstart/#about-responses>`__.

é‡å®šå‘å’Œé”™è¯¯
------------

ä½ å¯ä»¥ä½¿ç”¨
```redirect()`` <http://flask.pocoo.org/docs/0.12/api/#flask.redirect>`__
å‡½æ•°å°†ç”¨æˆ·å®šå‘åˆ°å…¶ä»–ä½ç½®; ç»ˆæ­¢ç”¨æˆ·è¯·æ±‚,è¿”å›é”™è¯¯ä»£ç ä½¿ç”¨
```abort()`` <http://flask.pocoo.org/docs/0.12/api/#flask.abort>`__
å‡½æ•°:

.. code:: python

    from flask import abort, redirect, url_for

    @app.route('/')
    def index():
        return redirect(url_for('login'))

    @app.route('/login')
    def login():
        abort(401)
        this_is_never_executed()

è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰æ„ä¹‰çš„ğŸŒ°, ç”¨æˆ·è®¿é—®ä¸»é¡µ,
å°†é‡å®šå‘åˆ°ä¸€ä¸ªä¸èƒ½è®¿é—®çš„é¡µé¢(401æ„å‘³ç€ç¦æ­¢è®¿é—®),
ä½†æ˜¯å®ƒå±•ç¤ºäº†é‡å®šå‘æ˜¯å¦‚ä½•å·¥ä½œçš„.

é»˜è®¤æƒ…å†µä¸‹, é”™è¯¯ä»£ç ä¼šæ˜¾ç¤ºä¸€ä¸ªé»‘ç™½çš„é”™è¯¯é¡µé¢, å¦‚æœä½ æƒ³å®šåˆ¶é”™è¯¯é¡µé¢,
ä½ å¯ä»¥ä½¿ç”¨
```errorhandler()`` <http://flask.pocoo.org/docs/0.12/api/#flask.Flask.errorhandler>`__
è£…é¥°å™¨:

.. code:: python

    from flask import render_template

    @app.errorhandler(404)
    def page_not_found(error):
        return render_template('page_not_found.html'), 404

æ³¨æ„, 404åœ¨è°ƒç”¨
```render_template()`` <http://flask.pocoo.org/docs/0.12/api/#flask.render_template>`__
ä¹‹å, è¿™å‘Šè¯‰Flask, è¯¥é¡µé¢çš„ä»£ç æ˜¯404(é¡µé¢ä¸å­˜åœ¨). é»˜è®¤é¡µé¢ä»£ç ä¸º200,
è¡¨ç¤ºä¸€åˆ‡ok.

æ›´å¤šç»†èŠ‚æŸ¥çœ‹ `Error
handlers <http://flask.pocoo.org/docs/0.12/errorhandling/#error-handlers>`__
.

å…³äºå“åº”
--------

è§†å›¾å‡½æ•°çš„è¿”å›å€¼ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºä¸€ä¸ªå“åº”å¯¹è±¡. å¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,
å®ƒå°†è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¸ºå“åº”ä¸»ä½“, ``200 ok``\ çŠ¶æ€ç ,
``MIME``\ ç±»å‹ä¸º\ ``text/html``\ çš„å“åº”å¯¹è±¡. Flask
å°†è¿”å›å€¼è½¬æ¢ä¸ºå“åº”å¯¹è±¡çš„é€»è¾‘å¦‚ä¸‹:

1. å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªåˆæ³•çš„å“åº”å¯¹è±¡, ä¼šç›´æ¥ä»è§†å›¾è¿”å›.
2. å¦‚æœè¿”å›å€¼ä¸ºå­—ç¬¦ä¸², ä¼šä½¿ç”¨å­—ç¬¦ä¸²æ•°æ®ä»¥åŠé»˜è®¤å‚æ•°åˆ›å»ºå“åº”å¯¹è±¡
3. å¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ªå…ƒç»„, å…ƒç»„å¯ä»¥æä¾›é¢å¤–çš„ä¿¡æ¯,
   ä½†æ˜¯å…ƒç»„å¿…é¡»æ˜¯\ ``(response, status, headers)``\ æˆ–\ ``(response, headers)``\ çš„å½¢å¼,
   ä¸”è‡³å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ . ``status``\ çš„å€¼ä¼šè¦†ç›–çŠ¶æ€ç ,
   ``headers``\ å¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨æˆ–è€…å­—å…¸, ä½œä¸ºé¢å¤–çš„è¡¨å¤´å€¼.
4. å¦‚æœä¸Šè¿°æ¡ä»¶éƒ½ä¸æ»¡è¶³, Flaskä¼šå‡è®¾è¿”å›å€¼æ˜¯ä¸€ä¸ªåˆæ³•çš„WSGIåº”ç”¨ç¨‹åº,
   å¹¶è½¬æ¢æˆä¸€ä¸ªå“åº”å¯¹è±¡.

å¦‚æœä½ æƒ³åœ¨è§†å›¾å‡½æ•°é‡Œé¢æ“çºµå“åº”å¯¹è±¡,
å¯ä»¥ä½¿ç”¨\ ```make_response()`` <http://flask.pocoo.org/docs/0.12/api/#flask.make_response>`__
å‡½æ•°.

å‡è®¾ä½ æœ‰è¿™æ ·ä¸€ä¸ªè§†å›¾å‡½æ•°

.. code:: python

    @app.errorhandler(404)
    def not_found(error):
        return render_template('error.html'), 404

ä½ åªéœ€è¦æŠŠè¿”å›å€¼è¡¨è¾¾å¼ä¼ ç»™
```make_response()`` <http://flask.pocoo.org/docs/0.12/api/#flask.make_response>`__
,è·å–å“åº”å¯¹è±¡, å¹¶ä¿®æ”¹,ç„¶åè¿”å›å®ƒ:

.. code:: python

    @app.errorhandler(404)
    def not_found(error):
        resp = make_response(render_template('error.html'), 404)
        resp.headers['X-Something'] = 'A value'
        return resp

Sessions
--------

é™¤äº†è¯·æ±‚å¯¹è±¡, è¿˜æœ‰ä¸€ä¸ª\ ``session``\ å¯¹è±¡.
å®ƒå…è®¸ä½ åœ¨ä¸åŒè¯·æ±‚é—´å­˜å‚¨ç”¨æˆ·ç‰¹å®šä¿¡æ¯. å®ƒæ˜¯åœ¨Cookiesçš„åŸºç¡€ä¸Šå®ç°çš„,
å¹¶ä¸”å¯¹Cookiesè¿›è¡Œå¯†é’¥ç­¾å. è¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥æŸ¥çœ‹cookieçš„å†…å®¹,
ä½†æ˜¯ä¸èƒ½ä¿®æ”¹å®ƒ, é™¤éç”¨æˆ·çŸ¥é“ç­¾åçš„å¯†é’¥.

è¦ä½¿ç”¨\ ``sessions`` éœ€è¦ä¸€ä¸ªè®¾ç½®ä¸€ä¸ªå¯†é’¥, ä¸‹é¢ä»‹ç»å¯†é’¥æ˜¯å¦‚ä½•å·¥ä½œçš„:

.. code:: python

    from flask import Flask, session, redirect, url_for, escape, request

    app = Flask(__name__)

    @app.route('/')
    def index():
        if 'username' in session:
            return 'Logged in as %s' % escape(session['username'])
        return 'You are not logged in'

    @app.route('/login', methods=['GET', 'POST'])
    def login():
        if request.method == 'POST':
            session['username'] = request.form['username']
            return redirect(url_for('index'))
        return '''
            <form method="post">
                <p><input type=text name=username>
                <p><input type=submit value=Login>
            </form>
        '''

    @app.route('/logout')
    def logout():
        # remove the username from the session if it's there
        session.pop('username', None)
        return redirect(url_for('index'))

    # set the secret key.  keep this really secret:
    app.secret_key = 'A0Zr98j/3yX R~XHH!jmN]LWX/,?RT'

è¿™é‡Œæåˆ°çš„
```escape()`` <http://flask.pocoo.org/docs/0.12/api/#flask.escape>`__
å¯ä»¥åœ¨æ¨¡æ¿å¼•æ“å¤–åšè½¬ä¹‰(å¦‚åŒæœ¬ä¾‹).

    å¦‚ä½•ç”Ÿæˆå¯†é’¥

.. code:: python

    >>> import os
    >>> os.urandom(24)
    '\xfd{H\xe5<\x95\xf9\xe3\x96.5\xd1\x01O<!\xd5\xa2\xa0\x9fR"\xa1\xa8'

    Just take that thing and copy/paste it into your code and you're done.

ä½¿ç”¨åŸºäºcookieçš„sessionséœ€è¦æ³¨æ„:
Flaskä¼šå°†ä½ æ”¾è¿›ä¼šè¯å¯¹è±¡çš„å€¼åºåˆ—åŒ–è‡³Cookies.
å¦‚æœä½ å‘ç°æŸäº›å€¼åœ¨è¯·æ±‚ä¹‹é—´æ²¡æœ‰æŒä¹…å­˜åœ¨, ä½†æ˜¯ç¡®å®å¯ç”¨äº†Cookies,
ä¹Ÿæ²¡æœ‰å¾—åˆ°æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯. æ­¤æ—¶, æ£€æŸ¥å“åº”é¡µé¢ä¸­Cookiesçš„å¤§å°,
ä¸webæµè§ˆå™¨æ‰€æ”¯æŒçš„å¤§å°è¿›è¡Œå¯¹æ¯”.

é™¤äº†é»˜è®¤åŸºäºå®¢æˆ·ç«¯çš„sessions, å¦‚æœä½ æƒ³åœ¨æœåŠ¡ç«¯å¤„ç†sessions,
Flaskä¹Ÿæœ‰æ‰©å±•æ’ä»¶æ”¯æŒ.

æ¶ˆæ¯é—ªç°
--------

åé¦ˆ, æ˜¯è‰¯å¥½çš„åº”ç”¨å’Œç”¨æˆ·ç•Œé¢çš„é‡è¦ç»„æˆéƒ¨åˆ†. å¦‚æœç”¨æˆ·æ²¡æœ‰å¾—åˆ°è¶³å¤Ÿçš„åé¦ˆ,
ä»–ä»¬å¯èƒ½ä¼šå¼€å§‹åŒæ¶è¿™ä¸ªåº”ç”¨. Flaskæä¾›ä¸€ä¸ªç®€å•çš„é—ªç°ç³»ç»Ÿ,
å°†åé¦ˆä¼ é€’ç»™ç”¨æˆ·. é—ªç°ç³»ç»Ÿé€šå¸¸ä¼šåœ¨è¯·æ±‚ç»“æŸæ—¶è®°å½•ä¿¡æ¯,
åœ¨ä¸‹ä¸€ä¸ª(ä»…åœ¨ä¸‹ä¸€ä¸ª)è¯·æ±‚ä¸­è®¿é—®è®°å½•çš„ä¿¡æ¯. å±•ç°è¿™äº›å†…å®¹éœ€è¦ç»“åˆæ¨¡æ¿å®ç°.

ä½¿ç”¨ ```flash()`` <http://flask.pocoo.org/docs/0.12/api/#flask.flash>`__
æ–¹æ³•é—ªç°ä¸€æ¡æ¶ˆæ¯, è¦æ“ä½œæ¶ˆæ¯æœ¬èº«å¯ä»¥ä½¿ç”¨
```get_flashed_messages()`` <http://flask.pocoo.org/docs/0.12/api/#flask.get_flashed_messages>`__
å‡½æ•°, åœ¨æ¨¡æ¿ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨.

å®Œæ•´çš„ç¤ºä¾‹æŸ¥çœ‹ `Message
Flashing <http://flask.pocoo.org/docs/0.12/patterns/flashing/#message-flashing-pattern>`__
.

æ—¥å¿—
----

0.3 æ–°åŠŸèƒ½

æœ‰æ—¶å€™ä½ ä¼šå¤„åœ¨è¿™æ ·ä¸€ç§æƒ…å½¢, ä½ å¤„ç†çš„æ•°æ®æœ¬åº”è¯¥æ˜¯æ­£ç¡®çš„, ä½†å®é™…ä¸Šå´ä¸æ˜¯.
æ¯”å¦‚, ä½ éœ€è¦å®¢æˆ·ç«¯ä»£ç å‘æœåŠ¡ç«¯å‘é€ä¸€äº›è¯·æ±‚, ä½†è¯·æ±‚æ˜¯ç•¸å½¢çš„.
è¿™å¯èƒ½æ˜¯ç”¨æˆ·ç¯¡æ”¹äº†æ•°æ®, æˆ–è€…å®¢æˆ·ç«¯ä»£ç é—®é¢˜.
å¤§å¤šæ•°æƒ…å†µä¸‹è¿”å›\ ``400 Bad Request``\ å³å¯, ä½†æ˜¯æœ‰æ—¶, ä¸èƒ½è¿™æ ·åš,
å¹¶ä¸”éœ€è¦ä»£ç ç»§ç»­è¿è¡Œ.

ä½ å¯èƒ½è¿˜å¸Œæœ›è®°å½•å‘ç”Ÿäº†ä»€ä¹ˆ. æ­¤æ—¶, ``loggers``\ å°±æ´¾ä¸Šç”¨åœºäº†, ä»Flask 0.3
å¼€å§‹, Flaskå°±é¢„ç½®äº†æ—¥å¿—ç³»ç»Ÿ.

ä¸‹é¢æ˜¯ä¸€äº›è®°å½•æ—¥å¿—çš„ä¾‹å­:

.. code:: python

    app.logger.debug('A value for debugging')
    app.logger.warning('A warning occurred (%d apples)', 42)
    app.logger.error('An error occurred')

é™„å¸¦çš„\ ``logger``\ æ˜¯ä¸€ä¸ªæ ‡å‡†æ—¥å¿— ``logger`` , æ›´å¤šä¿¡æ¯æŸ¥é˜… `logging
documentation <https://docs.python.org/library/logging.html>`__ .

`Application
Errors <http://flask.pocoo.org/docs/0.12/errorhandling/#application-errors>`__.

WSGIä¸­é—´ä»¶
----------

å¦‚æœä½ æƒ³ç»™ä½ çš„åº”ç”¨æ·»åŠ WSGIä¸­é—´ä»¶, ä½ å¯ä»¥å°è£…å†…éƒ¨WSGIåº”ç”¨. æ¯”å¦‚,
ä½ æƒ³ä½¿ç”¨WerkzeugåŒ…ä¸­çš„æŸä¸ªä¸­é—´ä»¶æ¥è§£å†³lighttpdä¸­çš„bugs, ä½ å¯ä»¥è¿™æ ·åš

.. code:: python

    from werkzeug.contrib.fixers import LighttpdCGIRootFix
    app.wsgi_app = LighttpdCGIRootFix(app.wsgi_app)

ä½¿ç”¨ Flask Extensions
---------------------

æ‰©å±•æ’ä»¶å¯ä»¥å¸®ä½ å®Œæˆå¸¸è§çš„ä»»åŠ¡. æ¯”å¦‚, Flask-SQLAlchemy æä¾› SQLAlchemy
æ”¯æŒ, å®ƒå¯ä»¥è®©ä½ æ›´ç®€å•çš„ä½¿ç”¨Flask.

æ›´å¤šå…³äºFlask æ‰©å±•æ’ä»¶çš„ä¿¡æ¯, æŸ¥é˜… `Flask
Extensions <http://flask.pocoo.org/docs/0.12/extensions/#extensions>`__.

éƒ¨ç½²åˆ° Web Server
-----------------

Ready to deploy your new Flask app? Go to `Deployment
Options <http://flask.pocoo.org/docs/0.12/deploying/#deployment>`__.
